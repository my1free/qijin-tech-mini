<template>
  <view class="content">
    <view class="item">
      <feed-detail :item="feedItem"></feed-detail>
    </view>
  </view>
</template>

<script>
import FeedDetail from "@/components/feed-detail.vue";
export default {
  components: {
    FeedDetail,
  },
  data() {
    return {
      me: {
        uid: 10000,
        name: "micheal",
      },
      currItemIdx: 0,
      currFromUser: null,
      //   dotsStyles: getApp().globalData.dotsStyles,
      isPreview: false,
      dotsStyles: {
        backgroundColor: "rgba(200, 200, 200, .3)",
        border: "1px rgba(0, 0, 0, .3) solid",
        selectedBackgroundColor: "#fff",
        selectedBorder: "1px rgba(0, 0, 0, .9) solid",
      },
      feedItem: {
        id: 20000002,
        user: {
          id: 10001,
          name: "å¾·å–„",
          avatar:
            "http://img.qijin.tech/VjLPWj5VftQJ13fea8ccf05e250236f9f60151b66b41.png",
        },
        content: {
          type: "text",
          text:
            "æˆ‘ä¸»åŠ¨æ‰“æ‹›å‘¼ï¼Œå¿«12ä¸ªå°æ—¶æ‰å›ï¼Œç¬¬ä¸€å¥å°±è«åå…¶å¦™åŠ ä¸ªğŸ˜ï¼Œé—®æ˜¯ä»€ä¹ˆæ„æ€åˆä¸è¯´è¯äº†ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ç›´æ¥æ‹‰é»‘äº†",
          // "æ¯å¤©ä¸€ä¸ªé—®å€™\næ¯å¤©ä¸€ä¸ªé—®å€™\næ¯å¤©ä¸€ä¸ªé—®å€™\næ¯å¤©ä¸€ä¸ªé—®å€™\næ¯å¤©ä¸€ä¸ªé—®å€™\næ¯å¤©ä¸€ä¸ªé—®å€™\næ¯å¤©ä¸€ä¸ªé—®å€™\næ¯å¤©ä¸€ä¸ªé—®å€™\næ¯å¤©ä¸€ä¸ªé—®å€™\næ¯å¤©ä¸€ä¸ªé—®å€™\n",
        },
        hasLiked: false,
        doInput: false,
        likeList: [
          {
            uid: 10002,
            avatar:
              "http://img.qijin.tech/VjLPWj5VftQJ13fea8ccf05e250236f9f60151b66b41.png",
            name: "é˜¿æ³½",
          },
          {
            uid: 10004,
            avatar:
              "http://img.qijin.tech/STfnOXeRhE2L939e55e15a4be7339f5d3c0b7d1cd432.png",
            name: "ç‹—ç„•",
          },
          {
            uid: 10005,
            avatar:
              "http://img.qijin.tech/1904DB5uJz009a56520fb877d20934063a15c0340f02.png",
            name: "å¨ƒå¨ƒé±¼",
          },
        ],
        likeCount: 32,
        commentCount: 40,
        commentList: [
          {
            id: 40000001,
            fromUser: {
              uid: 10002,
              avatar:
                "http://img.qijin.tech/VjLPWj5VftQJ13fea8ccf05e250236f9f60151b66b41.png",
              name: "é˜¿æ³½",
            },
            text: "æˆ‘äº²çˆ±çš„å¾·å–„",
          },
          {
            id: 40000002,
            fromUser: {
              uid: 10005,
              avatar:
                "http://img.qijin.tech/1904DB5uJz009a56520fb877d20934063a15c0340f02.png",
              name: "å¨ƒå¨ƒé±¼",
            },
            toUser: {
              uid: 10002,
              avatar:
                "http://img.qijin.tech/STfnOXeRhE2L939e55e15a4be7339f5d3c0b7d1cd432.png",
              name: "é˜¿æ³½",
            },
            text: "èƒ½ä¸èƒ½ä¸è¦è¿™ä¹ˆæ¶å¿ƒ",
          },
          {
            id: 40000003,
            fromUser: {
              uid: 10004,
              avatar:
                "http://img.qijin.tech/STfnOXeRhE2L939e55e15a4be7339f5d3c0b7d1cd432.png",
              name: "ç‹—ç„•",
            },
            text: "è—èµ·æ¥~~",
          },
          {
            id: 40000004,
            fromUser: {
              uid: 10004,
              avatar:
                "http://img.qijin.tech/STfnOXeRhE2L939e55e15a4be7339f5d3c0b7d1cd432.png",
              name: "ç‹—ç„•",
            },
            text: "é˜¿è¨å¾·å¯Œå…°å…‹æ—æ°´ç”µè´¹å°½é‡å°‘æ‰“é£æœº",
          },
          {
            id: 40000005,
            fromUser: {
              uid: 10004,
              avatar:
                "http://img.qijin.tech/STfnOXeRhE2L939e55e15a4be7339f5d3c0b7d1cd432.png",
              name: "ç‹—ç„•",
            },
            text:
              "é˜¿å£«å¤§å¤«æ’’æ—¦æ³• æ’’æ‰“é£æœºæ‹‰åŒæ–¹å‡å¯¹æ‹‰ä¸è§£æ”¾è·¯æ’’ å‘è‹æ‰“ç»¿å‘æ’’æ‹‰å‘åŠ¨æœº",
          },
          {
            id: 40000006,
            fromUser: {
              uid: 10004,
              avatar:
                "http://img.qijin.tech/STfnOXeRhE2L939e55e15a4be7339f5d3c0b7d1cd432.png",
              name: "ç‹—ç„•",
            },
            text: "ä»¨",
          },
          {
            id: 40000007,
            fromUser: {
              uid: 10004,
              avatar:
                "http://img.qijin.tech/STfnOXeRhE2L939e55e15a4be7339f5d3c0b7d1cd432.png",
              name: "ç‹—ç„•",
            },
            text: "è—èµ·æ¥~~",
          },
        ],
      },
      previewList: [
        "/static/image/deshan2.jpg",
        "/static/image/deshan3.jpg",
        "/static/image/aze.jpeg",
        "/static/image/aze2.jpeg",
      ],
      previewIdx: 0,
      show: false,
      opShow: false,
    };
  },
  onLoad() {},
  onPullDownRefresh() {
    console.log("onPullDownRefresh");
  },
  methods: {
    open(mode) {
      this.show = !this.show;
    },
    change() {
      console.log("è§¦å‘åŠ¨ç”»");
    },
    onPreviewSwiperChange(e) {
      this.previewIdx = e.detail.current;
    },
    onPreview(idx, urls) {
      uni.previewImage({
        current: idx,
        urls: urls,
        longPressActions: {
          itemList: ["å‘é€ç»™æœ‹å‹", "ä¿å­˜å›¾ç‰‡", "æ”¶è—"],
          success: function(data) {
            console.log(
              "é€‰ä¸­äº†ç¬¬" +
                (data.tapIndex + 1) +
                "ä¸ªæŒ‰é’®,ç¬¬" +
                (data.index + 1) +
                "å¼ å›¾ç‰‡"
            );
          },
          fail: function(err) {
            console.log(err.errMsg);
          },
        },
      });
    },
    onPreviewClose() {
      console.log("close");
      this.isPreview = false;
      this.previewList = [];
      this.previewIdx = 0;
    },
    onLikeTab(itemIdx, likeIdx) {
      console.log("onLikeTab", itemIdx, likeIdx);
    },
    onCommentLineTab(itemIdx, commentIdx, e) {
      console.log("onCommentLineTab", itemIdx, commentIdx);
      console.log("onCommentLineTab", e.detail);

      let fromUser = this.itemList[itemIdx].commentList[commentIdx].fromUser;
      if (fromUser.uid == this.me.uid) {
        this.opShow = true;
        return;
      }
      console.log("onCommentLineTab", fromUser);
      this.currFromUser = fromUser;
      this.currItemIdx = itemIdx;
      this.itemList[itemIdx].doInput = true;
    },
    onLike(itemIdx) {
      let likeList = this.itemList[itemIdx].likeList;
      if (likeList == null) {
        likeList = [];
      }
      console.log("onLike", itemIdx, this.itemList[itemIdx].hasLiked);
      if (this.itemList[itemIdx].hasLiked) {
        // å¦‚æœå·²ç»å­˜åœ¨äº†ï¼Œåˆ™éœ€è¦åˆ é™¤
        let me = this.me;
        var flist = likeList.filter(function(like) {
          return like.uid != me.uid;
        });
        this.itemList[itemIdx].likeList = flist;
      } else {
        // å¦‚æœæ²¡æœ‰å­˜åœ¨ï¼Œåˆ™éœ€è¦åŠ å…¥
        if (likeList.length == 0) {
          likeList.push(this.me);
          this.itemList[itemIdx].likeList = likeList;
        } else {
          likeList.push(this.me);
        }
      }
      this.itemList[itemIdx].hasLiked = !this.itemList[itemIdx].hasLiked;
    },
    onComment(itemIdx) {
      this.itemList[itemIdx].doInput = true;
      this.currItemIdx = itemIdx;
    },
    closeKeyboard(e) {
      this.itemList[this.currItemIdx].doInput = false;
      // clear
      this.currFromUser = null;
    },
    confirmComment(e) {
      let itemIdx = this.currItemIdx;
      this.itemList[itemIdx].doInput = false;
      let textContent = e.detail.value;
      let commentList = this.itemList[itemIdx].commentList;
      let newComment = {
        id: this.me.uid,
        fromUser: {
          uid: this.me.uid,
          name: this.me.name,
        },
        text: textContent,
      };
      if (this.currFromUser != null) {
        newComment.toUser = this.currFromUser;
      }
      if (commentList == null) {
        console.log("null");
        commentList = [];
        commentList.push(newComment);
        this.itemList[itemIdx].commentList = commentList;
      } else {
        this.itemList[itemIdx].commentList.push(newComment);
      }
      // clear
      this.currFromUser = null;
    },
    onCardDetail(uid) {
      console.log(uid);
      uni.navigateTo({
        url: "/pages/social/detail/index",
        events: {
          // ä¸ºæŒ‡å®šäº‹ä»¶æ·»åŠ ä¸€ä¸ªç›‘å¬å™¨ï¼Œè·å–è¢«æ‰“å¼€é¡µé¢ä¼ é€åˆ°å½“å‰é¡µé¢çš„æ•°æ®
          acceptDataFromOpenedPage: function(data) {
            console.log(data);
          },
          someEvent: function(data) {
            console.log(data);
          },
        },
        success: function(res) {
          console.log("success", res);
        },
        fail: function(res) {
          console.log("fail", res);
        },
      });
    },
  },
};
</script>

<style>
@import "/static/css/square.css";
@import "/static/css/my-ui.css";
@import "/static/css/common.css";
page {
  background-color: #eeeeee;
}
.content {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: 32rpx;
}
.item {
  width: 100%;
}
</style>
